
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Page-Enter" content="blendTrans(Duration=2)" />
<meta http-equiv="Site-Exit" content="blendTrans(Duration=5)" />

<link rel="stylesheet" type="text/css" href="Combox.css" />

<title>Skippers</title>

<script src="EchoPainter.js"></script>
<script src="jquery.js"></script>

<script type="text/javascript" charset="UTF-8">
	//ISO-8859-1">
	var echoCanvas1;
	var echoCanvas2;
	var dataReceived = 0;
	var newColorArrayCh1;
	var newColorArrayCh2;
	
	dataParameter = 1;
	window.onload = initEchoPainting;
	
	function initEchoPainting() {
		initOneCanvas();
		startDataProviderTimer();
		startPaintingCanvasTimer();
	}

	function initOneCanvas() {
		echoCanvas1 = new EchoCanvas(0, 0, 900, 400);
		echoCanvas2 = null;
	}
	
	function initBothCanvas() {
		echoCanvas1 = new EchoCanvas(0, 0, 450, 400);
		echoCanvas2 = new EchoCanvas(450, 0, 450, 400);
	}

	//////////////////////////////////////////////////
	// TIMER USED FOR GETING OF SENSOR DATA FROM 
	// THE WEB SERVER.
	//////////////////////////////////////////////////
	function startDataProviderTimer() {
		t = setTimeout("onDataProviderTimer()", 500);
	}

	////////////////////////////////////////////////
	// Get echo data from php
	////////////////////////////////////////////////
	function onDataProviderTimer() {
		$.get("dataProvider.php", // calling php
		{
			index : "c" + dataParameter // c1 when 1 channel requested. c2 for 2 chanels
		}, // parameter to send
		function(data) { // callback function
			parseEchoData(data);
			//$('#timeval').html(data); // don't remove. It displays received message
		}

		); // end of "$get"

		startDataProviderTimer();
		///////////////////////////////////////////////
		// Don't remove: The same using jquery function "load"
		///////////////////////////////////////////////
		//$('#timeval').load('dataProvider.php?randval='+ Math.random());
	}
	
	////////////////////////////////////////////////
	// Parse echo data received from php
	////////////////////////////////////////////////
	function parseEchoData(data){
		var chanelsArray = data.split("CH");
		newColorArrayCh1 = chanelsArray[0].split(",");
		if (chanelsArray.length > 1)
			newColorArrayCh2 = chanelsArray[1].split(",");
		
		dataReceived = 1;
		echoCanvas1.setNewData(newColorArrayCh1);
		if (echoCanvas2 != null)
			echoCanvas2.setNewData(newColorArrayCh2);
		//startDataProviderTimer(); // if you start timer from here, it will take 500ms (timer time) + around 500ms for sending/receiving of data
	}

	//////////////////////////////////////////////////
	//TIMER USED FOR ECHO PAINTING USING CANVAS
	//////////////////////////////////////////////////
	function startPaintingCanvasTimer() {
		t = setTimeout("onPaintingCanvasTimer()", 50);
	}

	function onPaintingCanvasTimer() {
		if (dataReceived > 0) {
			echoCanvas1.echoPainter_PaintCanvas();	
			if (echoCanvas2 != null)
				echoCanvas2.echoPainter_PaintCanvas();	
		}
		startPaintingCanvasTimer();
	}
</script>
</head>


<body>
	<div id="wrap">
		<div id="container">
			<div id="timeval"></div> <!-- used only for test-->
			<canvas id="echoCanvas" width="900" height="400"></canvas>
			<div class="menuDown">
				<div class="buttonsDiv">
					<a href="#" class="myButton" onclick="initOneCanvas()">One channel</a>
					<a href="#" class="myButton" onclick="initBothCanvas()">Two channels</a>
					<a href="#" class="myButton" onclick="changeToGreen()">Test</a>
				</div>
			</div>
		</div>
	</div>
</body>
</html>


